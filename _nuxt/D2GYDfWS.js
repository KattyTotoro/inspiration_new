import{u as y,E as h,S,I as B,t as I}from"./xssvhLtD.js";import{f as H,r as g,y as E,u as L,z as O,h as t,c,a as s,i as p,j as T,b as w,A as V,F as D,m as M,B as m,v as C,C as l,k as P,o as v,t as U,D as z}from"./CHs4_4Lm.js";const N={key:0,class:"content tt"},q=["value"],F={key:0},R=["disabled"],j=["disabled"],K=["disabled"],G=["disabled"],J=["disabled"],Q=["disabled"],W={key:1},_=H({__name:"post_create copy",setup(X){const f=g(1),$=E(),b=L(),o=g({}),d=g(""),k=g(null),i=y({content:"",extensions:[S,B]}),x=async()=>{const a=k.value,e=new FormData;if(a.files){e.append("alt",d.value),e.append("img",a.files[0]);const r=await $fetch("/api/img",{method:"POST",body:e});d.value="",a.value="",setTimeout(()=>{var u;(u=i.value)==null||u.chain().focus().setImage({src:r.url,alt:d.value}).run()},500)}},A=async()=>{var a,e;if(o.value&&((a=b.user)!=null&&a.id)){o.value.title_en=I(o.value.title),o.value.text=((e=i.value)==null?void 0:e.getHTML().replaceAll("<p></p>","<br>"))||"";const r=o.value.text.indexOf('<img src="');if(r!=-1){const n=o.value.text.indexOf('"',r+10);o.value.img=o.value.text.slice(r+10,n)}const u=o.value.text.indexOf("<p>");if(u!=-1){const n=o.value.text.indexOf("</p>",u+3);o.value.preview=o.value.text.slice(u+3,n).replace(/<[^>]*>/g,"")}o.value.author_id=b.user.id,o.value.rubric_id=f.value,await $fetch("/api/post",{method:"POST",body:o.value}),z("/lk")}};return O(()=>{var a;(a=t(i))==null||a.destroy()}),(a,e)=>{var u;const r=h;return(u=t(b).user)!=null&&u.id?(v(),c("section",N,[e[26]||(e[26]=s("label",{class:"label_rubric_create",for:"rubric"},"Выбор рубрики: ",-1)),p(s("select",{class:"rubric_create",name:"rubric",id:"rubric","onUpdate:modelValue":e[0]||(e[0]=n=>m(f)?f.value=n:null)},[(v(!0),c(D,null,M(t($).rubrics,n=>(v(),c("option",{value:n.id,key:n.id},U(n.title),9,q))),128))],512),[[V,t(f)]]),p(s("input",{class:"myEditor",type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>t(o).title=n),placeholder:"Введите название публикации"},null,512),[[C,t(o).title]]),t(i)?(v(),c("div",F,[s("button",{onClick:e[2]||(e[2]=n=>t(i).chain().focus().toggleBold().run()),disabled:!t(i).can().chain().focus().toggleBold().run(),class:l({"is-active":t(i).isActive("bold")})}," жирный ",10,R),s("button",{onClick:e[3]||(e[3]=n=>t(i).chain().focus().toggleItalic().run()),disabled:!t(i).can().chain().focus().toggleItalic().run(),class:l({"is-active":t(i).isActive("italic")})}," курсив ",10,j),s("button",{onClick:e[4]||(e[4]=n=>t(i).chain().focus().toggleStrike().run()),disabled:!t(i).can().chain().focus().toggleStrike().run(),class:l({"is-active":t(i).isActive("strike")})}," перечёркнутый ",10,K),s("button",{onClick:e[5]||(e[5]=n=>t(i).chain().focus().toggleCode().run()),disabled:!t(i).can().chain().focus().toggleCode().run(),class:l({"is-active":t(i).isActive("code")})}," код ",10,G),s("button",{onClick:e[6]||(e[6]=n=>t(i).chain().focus().unsetAllMarks().run())}," clear marks "),s("button",{onClick:e[7]||(e[7]=n=>t(i).chain().focus().clearNodes().run())}," clear nodes "),s("button",{onClick:e[8]||(e[8]=n=>t(i).chain().focus().setParagraph().run()),class:l({"is-active":t(i).isActive("paragraph")})}," paragraph ",2),s("button",{onClick:e[9]||(e[9]=n=>t(i).chain().focus().toggleHeading({level:1}).run()),class:l({"is-active":t(i).isActive("heading",{level:1})})}," h1 ",2),s("button",{onClick:e[10]||(e[10]=n=>t(i).chain().focus().toggleHeading({level:2}).run()),class:l({"is-active":t(i).isActive("heading",{level:2})})}," h2 ",2),s("button",{onClick:e[11]||(e[11]=n=>t(i).chain().focus().toggleHeading({level:3}).run()),class:l({"is-active":t(i).isActive("heading",{level:3})})}," h3 ",2),s("button",{onClick:e[12]||(e[12]=n=>t(i).chain().focus().toggleHeading({level:4}).run()),class:l({"is-active":t(i).isActive("heading",{level:4})})}," h4 ",2),s("button",{onClick:e[13]||(e[13]=n=>t(i).chain().focus().toggleHeading({level:5}).run()),class:l({"is-active":t(i).isActive("heading",{level:5})})}," h5 ",2),s("button",{onClick:e[14]||(e[14]=n=>t(i).chain().focus().toggleHeading({level:6}).run()),class:l({"is-active":t(i).isActive("heading",{level:6})})}," h6 ",2),e[24]||(e[24]=s("br",null,null,-1)),s("button",{onClick:e[15]||(e[15]=n=>t(i).chain().focus().toggleBulletList().run()),class:l({"is-active":t(i).isActive("bulletList")})}," bullet list ",2),s("button",{onClick:e[16]||(e[16]=n=>t(i).chain().focus().toggleOrderedList().run()),class:l({"is-active":t(i).isActive("orderedList")})}," ordered list ",2),s("button",{onClick:e[17]||(e[17]=n=>t(i).chain().focus().toggleCodeBlock().run()),class:l({"is-active":t(i).isActive("codeBlock")})}," code block ",2),s("button",{onClick:e[18]||(e[18]=n=>t(i).chain().focus().toggleBlockquote().run()),class:l({"is-active":t(i).isActive("blockquote")})}," blockquote ",2),s("button",{onClick:e[19]||(e[19]=n=>t(i).chain().focus().setHorizontalRule().run())}," horizontal rule "),s("button",{onClick:e[20]||(e[20]=n=>t(i).chain().focus().setHardBreak().run())}," hard break "),s("button",{onClick:e[21]||(e[21]=n=>t(i).chain().focus().undo().run()),disabled:!t(i).can().chain().focus().undo().run()}," undo ",8,J),s("button",{onClick:e[22]||(e[22]=n=>t(i).chain().focus().redo().run()),disabled:!t(i).can().chain().focus().redo().run()}," redo ",8,Q)])):T("",!0),w(r,{editor:t(i)},null,8,["editor"]),s("div",null,[s("form",{method:"post",onSubmit:P(x,["prevent"])},[p(s("input",{type:"text",name:"alt","onUpdate:modelValue":e[23]||(e[23]=n=>m(d)?d.value=n:null),placeholder:"Alt"},null,512),[[C,t(d)]]),s("input",{type:"file",ref_key:"file",ref:k,placeholder:"Изображение"},null,512),e[25]||(e[25]=s("input",{type:"submit",value:"Загрузить"},null,-1))],32)]),s("button",{onClick:A},"save")])):(v(),c("section",W," Login first "))}}});export{_ as default};
