import{u as P,E as D,S as N,I as O,t as V}from"./D5KmMvzy.js";import{f as M,r as f,y as U,p as z,l as F,z as q,h as n,c,j as k,i as m,b as A,a as i,v as h,F as B,A as j,m as J,C as l,k as R,w as K,e as Y,n as G,o as v,t as w,d as Q,D as E}from"./BHoSufKp.js";const W={key:0,class:"content tt"},X=["value"],Z={key:1},_=["disabled"],tt=["disabled"],et=["disabled"],nt=["disabled"],st=["disabled"],it=["disabled"],ot={class:"tiptapImg"},dt=M({__name:"[id]",async setup(lt){var $,y;let p,C;const d=f(""),x=f(null),g=f(1),I=U(),S=async()=>{const a=x.value,t=new FormData;if(a.files){t.append("alt",d.value),t.append("img",a.files[0]);const r=await $fetch("/api/img",{method:"POST",body:t});d.value="",a.value="",setTimeout(()=>{var u;(u=e.value)==null||u.chain().focus().setImage({src:r.url,alt:d.value}).run()},500)}},b=z().params.id,{data:H}=([p,C]=F(()=>G(`/api/post/${b}`,"$b1kuJYDcbE")),p=await p,C(),p),o=f(($=H.value)==null?void 0:$.post),e=P({content:(y=o.value)==null?void 0:y.text,extensions:[N,O]}),T=async()=>{var a,t;if(o.value){o.value.title_en=V(o.value.title),o.value.text=((a=e.value)==null?void 0:a.getHTML().replaceAll("<p></p>","<br>"))||"";const r=o.value.text.indexOf('<img src="');if(r!=-1){const s=o.value.text.indexOf('"',r+10);o.value.img=o.value.text.slice(r+10,s)}const u=o.value.text.indexOf("<p>");if(u!=-1){const s=o.value.text.indexOf("</p>",u+3);o.value.preview=o.value.text.slice(u+3,s).replace(/<[^>]*>/g,"")}o.value.text=((t=e.value)==null?void 0:t.getHTML().replaceAll("<p></p>","<br>"))||"",o.value.rubric_id=g.value,await fetch(`/api/post/${b}`,{method:"PUT",body:JSON.stringify(o.value)}),E("/lk")}};q(()=>{var a;(a=n(e))==null||a.destroy()});const L=async()=>{if(confirm("Вы уверены, что хотите удалить этот пост?"))try{(await(await fetch(`/api/post/${b}`,{method:"DELETE"})).json()).success?(alert("Пост успешно удалён"),E("/lk")):alert("Не удалось удалить пост")}catch(a){console.error("Ошибка при удалении поста:",a),alert("Произошла ошибка при удалении поста")}};return(a,t)=>{const r=D,u=Y;return o.value?(v(),c("section",W,[m(i("input",{class:"myEditor",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>o.value.title=s)},null,512),[[h,o.value.title]]),o.value.approved?k("",!0):(v(),c(B,{key:0},[t[24]||(t[24]=i("label",{class:"label_rubric_create",for:"rubric"},"Выбор рубрики: ",-1)),m(i("select",{class:"rubric_create",name:"rubric",id:"rubric","onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s)},[(v(!0),c(B,null,J(n(I).rubrics,s=>(v(),c("option",{value:s.id,key:s.id},w(s.title),9,X))),128))],512),[[j,g.value]])],64)),n(e)?(v(),c("div",Z,[i("button",{onClick:t[2]||(t[2]=s=>n(e).chain().focus().toggleBold().run()),disabled:!n(e).can().chain().focus().toggleBold().run(),class:l({"is-active":n(e).isActive("bold")})}," жирный ",10,_),i("button",{onClick:t[3]||(t[3]=s=>n(e).chain().focus().toggleItalic().run()),disabled:!n(e).can().chain().focus().toggleItalic().run(),class:l({"is-active":n(e).isActive("italic")})}," курсив ",10,tt),i("button",{onClick:t[4]||(t[4]=s=>n(e).chain().focus().toggleStrike().run()),disabled:!n(e).can().chain().focus().toggleStrike().run(),class:l({"is-active":n(e).isActive("strike")})}," перечёркнутый ",10,et),i("button",{onClick:t[5]||(t[5]=s=>n(e).chain().focus().toggleCode().run()),disabled:!n(e).can().chain().focus().toggleCode().run(),class:l({"is-active":n(e).isActive("code")})}," код ",10,nt),i("button",{onClick:t[6]||(t[6]=s=>n(e).chain().focus().unsetAllMarks().run())}," clear marks "),i("button",{onClick:t[7]||(t[7]=s=>n(e).chain().focus().clearNodes().run())}," clear nodes "),i("button",{onClick:t[8]||(t[8]=s=>n(e).chain().focus().setParagraph().run()),class:l({"is-active":n(e).isActive("paragraph")})}," paragraph ",2),i("button",{onClick:t[9]||(t[9]=s=>n(e).chain().focus().toggleHeading({level:1}).run()),class:l({"is-active":n(e).isActive("heading",{level:1})})}," h1 ",2),i("button",{onClick:t[10]||(t[10]=s=>n(e).chain().focus().toggleHeading({level:2}).run()),class:l({"is-active":n(e).isActive("heading",{level:2})})}," h2 ",2),i("button",{onClick:t[11]||(t[11]=s=>n(e).chain().focus().toggleHeading({level:3}).run()),class:l({"is-active":n(e).isActive("heading",{level:3})})}," h3 ",2),i("button",{onClick:t[12]||(t[12]=s=>n(e).chain().focus().toggleHeading({level:4}).run()),class:l({"is-active":n(e).isActive("heading",{level:4})})}," h4 ",2),i("button",{onClick:t[13]||(t[13]=s=>n(e).chain().focus().toggleHeading({level:5}).run()),class:l({"is-active":n(e).isActive("heading",{level:5})})}," h5 ",2),i("button",{onClick:t[14]||(t[14]=s=>n(e).chain().focus().toggleHeading({level:6}).run()),class:l({"is-active":n(e).isActive("heading",{level:6})})}," h6 ",2),t[25]||(t[25]=i("br",null,null,-1)),i("button",{onClick:t[15]||(t[15]=s=>n(e).chain().focus().toggleBulletList().run()),class:l({"is-active":n(e).isActive("bulletList")})}," bullet list ",2),i("button",{onClick:t[16]||(t[16]=s=>n(e).chain().focus().toggleOrderedList().run()),class:l({"is-active":n(e).isActive("orderedList")})}," ordered list ",2),i("button",{onClick:t[17]||(t[17]=s=>n(e).chain().focus().toggleCodeBlock().run()),class:l({"is-active":n(e).isActive("codeBlock")})}," code block ",2),i("button",{onClick:t[18]||(t[18]=s=>n(e).chain().focus().toggleBlockquote().run()),class:l({"is-active":n(e).isActive("blockquote")})}," blockquote ",2),i("button",{onClick:t[19]||(t[19]=s=>n(e).chain().focus().setHorizontalRule().run())}," horizontal rule "),i("button",{onClick:t[20]||(t[20]=s=>n(e).chain().focus().setHardBreak().run())}," hard break "),i("button",{onClick:t[21]||(t[21]=s=>n(e).chain().focus().undo().run()),disabled:!n(e).can().chain().focus().undo().run()}," undo ",8,st),i("button",{onClick:t[22]||(t[22]=s=>n(e).chain().focus().redo().run()),disabled:!n(e).can().chain().focus().redo().run()}," redo ",8,it)])):k("",!0),A(r,{editor:n(e)},null,8,["editor"]),i("div",ot,[i("form",{method:"post",onSubmit:R(S,["prevent"])},[m(i("input",{type:"text",name:"alt","onUpdate:modelValue":t[23]||(t[23]=s=>d.value=s),placeholder:"Название картинки"},null,512),[[h,d.value]]),i("input",{type:"file",ref_key:"file",ref:x,placeholder:"Изображение"},null,512),t[26]||(t[26]=i("input",{class:"uploadPicBut",type:"submit",value:"Загрузить"},null,-1))],32)]),i("button",{onClick:T},"Сохранить пост"),A(u,{to:`/posts/${o.value.id}_${o.value.title_en}`},{default:K(()=>[Q(w(o.value.title),1)]),_:1},8,["to"]),i("button",{class:"deletPostButtom",onClick:L},"Удалить пост")])):k("",!0)}}});export{dt as default};
