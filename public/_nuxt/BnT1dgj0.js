import{f as L,r as i,u as M,q as S,s as P,c as a,a as t,j as d,h as v,i as m,v as c,k as C,t as f,x as T,b as x,w as V,F as j,m as D,e as E,o,d as U,_ as F}from"./BHoSufKp.js";import{_ as z}from"./DC7j6wU7.js";const A={class:"content"},R={key:0,class:"nickname"},G={key:1,class:"tabs"},H={key:0,class:"tab"},J={class:"tab-content"},K={key:0,class:"error"},O={key:1,class:"tab"},Q={class:"tab-content"},W={key:0,class:"error"},X={key:2},Y={key:1},Z={class:"blockList"},ee=L({__name:"index",setup(te){const y=i(!0),u=i(""),r=i(""),b=i(""),k=i(""),_=i([]),l=M(),g=i(""),$=async()=>{await l.logIn(u.value,r.value),l.user&&w()};S(()=>{var n;!_.value.length&&((n=l.user)!=null&&n.id)&&w()});const h=async()=>{if(r.value!==b.value){g.value="Пароли не совпадают";return}try{g.value="",await l.regIn(u.value,r.value),u.value="",r.value="",b.value="",y.value=!0}catch{g.value="Ошибка регистрации. Возможно, email уже занят"}},B=async()=>{$fetch("/api/user_name",{method:"PUT",body:l.user})},w=async()=>{var p;const e=await(await fetch("/api/post/by_users_lk/"+((p=l.user)==null?void 0:p.id))).json();_.value=(e==null?void 0:e.posts)||[]};return P(()=>l.user,n=>{n!=null&&n.id&&w()}),(n,e)=>{var N,q;const p=E,I=z;return o(),a("section",A,[e[17]||(e[17]=t("h1",{class:"lk_h1"},"Личный кабинет",-1)),v(l).user?(o(),a("div",R,[e[8]||(e[8]=t("p",null,"Ваш ник: ",-1)),t("div",null,[m(t("input",{type:"text",name:"nickname","onUpdate:modelValue":e[0]||(e[0]=s=>v(l).user.name=s),placeholder:"Введите Ваш ник"},null,512),[[c,v(l).user.name]]),t("button",{onClick:B},"Сохранить")])])):d("",!0),v(l).user?d("",!0):(o(),a("div",G,[t("input",{type:"radio",id:"tab-login",name:"tab-group",checked:"",onClick:e[1]||(e[1]=s=>y.value=!0)}),e[11]||(e[11]=t("label",{for:"tab-login",style:{width:"81px"},class:"tab-title"},"Вход",-1)),t("input",{type:"radio",id:"tab-register",name:"tab-group",onClick:e[2]||(e[2]=s=>y.value=!1)}),e[12]||(e[12]=t("label",{for:"tab-register",style:{width:"140px"},class:"tab-title"},"Регистрация",-1)),e[13]||(e[13]=t("br",null,null,-1)),y.value?(o(),a("div",H,[t("div",J,[t("form",{class:"lk_entrance",onSubmit:C($,["prevent"])},[m(t("input",{type:"email","onUpdate:modelValue":e[3]||(e[3]=s=>u.value=s),placeholder:"Введите почту",required:""},null,512),[[c,u.value]]),m(t("input",{type:"password","onUpdate:modelValue":e[4]||(e[4]=s=>r.value=s),placeholder:"Введите пароль",required:""},null,512),[[c,r.value]]),e[9]||(e[9]=t("button",{type:"submit"},"Войти",-1)),k.value?(o(),a("p",K,f(k.value),1)):d("",!0)],32)])])):(o(),a("div",O,[t("div",Q,[t("form",{class:"lk_entrance",onSubmit:C(h,["prevent"])},[m(t("input",{type:"email","onUpdate:modelValue":e[5]||(e[5]=s=>u.value=s),placeholder:"Введите почту",required:""},null,512),[[c,u.value]]),m(t("input",{type:"password","onUpdate:modelValue":e[6]||(e[6]=s=>r.value=s),placeholder:"Введите пароль",required:""},null,512),[[c,r.value]]),m(t("input",{type:"password","onUpdate:modelValue":e[7]||(e[7]=s=>b.value=s),placeholder:"Повторите пароль",required:""},null,512),[[c,b.value]]),e[10]||(e[10]=t("button",{type:"submit"},"Зарегистрироваться",-1)),k.value?(o(),a("p",W,f(k.value),1)):d("",!0)],32)])]))])),v(l).user?(o(),a("div",X,[((N=v(l).user)==null?void 0:N.role)=="moderator"?(o(),T(p,{key:0,to:"/lk/moderation",class:"post_create_button"},{default:V(()=>e[14]||(e[14]=[U("Модерация")])),_:1})):d("",!0),e[16]||(e[16]=t("h2",{class:"myPublications"},"Мои публикации",-1)),(q=_.value)!=null&&q.length?d("",!0):(o(),a("p",Y,"Публикаций пока нет")),x(p,{to:"/lk/post_create",class:"post_create_button"},{default:V(()=>e[15]||(e[15]=[U("Добавить публикацию")])),_:1}),t("div",Z,[(o(!0),a(j,null,D(_.value,s=>(o(),a("div",{class:"post",key:s.id},[x(I,{src:`${s.img}`,sizes:"300px"},null,8,["src"]),t("h2",null,[x(p,{to:`/lk/post_edit/${s.id}`},{default:V(()=>[U(f(s.title),1)]),_:2},1032,["to"])]),t("p",null,f(s.preview),1)]))),128))])])):d("",!0)])}}}),oe=F(ee,[["__scopeId","data-v-e58d3904"]]);export{oe as default};
