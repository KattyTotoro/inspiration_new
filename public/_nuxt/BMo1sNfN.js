import{f as w,r as v,c as f,o as u,a as o,j as k,d as x,t as S,h as c,k as B,i as N,v as $,B as b,F as C,m as A,x as K,L as V,l as L,u as O,n as F}from"./BHoSufKp.js";const J=["innerHTML"],T=w({__name:"CommentComponent",props:["comment","margin","author_id","refresh"],setup(t){const n=t,l=v(!1),e=v(""),d=async()=>{if(!n.author_id)return alert("Reg or log IN");e.value=e.value.replaceAll("<","&lt;").replaceAll(">","&gt;"),e.value&&(await fetch(`/api/comments/${n.comment.post_id}`,{method:"POST",body:JSON.stringify({text:e.value,post_id:n.comment.post_id,author_id:n.author_id,comment_id:n.comment.id})}),l.value=!1,e.value="",n.refresh())},y=r=>{(r.keyCode==10||r.keyCode==13)&&(r.ctrlKey||r.metaKey)&&d()};return(r,a)=>{const p=T;return u(),f("div",{style:V(`margin-left: ${t.margin}px`)},[o("div",null,[o("p",{innerHTML:t.comment.text.replaceAll(`
`,"<br>")},null,8,J),o("p",null,[x(S(t.comment.created_at)+" ",1),o("button",{class:"reply",onClick:a[0]||(a[0]=m=>l.value=!c(l))},"Ответить"),x(" "+S(t.comment.comments_num),1)])]),c(l)?(u(),f("form",{key:0,onSubmit:B(d,["prevent"])},[N(o("textarea",{class:"enterComment",placeholder:"Введите комментарий","onUpdate:modelValue":a[1]||(a[1]=m=>b(e)?e.value=m:null),onKeydown:y},null,544),[[$,c(e)]])],32)):k("",!0),t.comment.comments?(u(!0),f(C,{key:1},A(t.comment.comments,m=>(u(),K(p,{key:m.id,comment:m,margin:t.margin+10,author_id:t.author_id,refresh:t.refresh},null,8,["comment","margin","author_id","refresh"]))),128)):k("",!0)],4)}}}),R={class:"comments"},D=w({__name:"CommentsBlock",props:["post_id"],async setup(t){let n,l;const e=v(""),d=t,{data:y,refresh:r}=([n,l]=L(()=>F(`/api/comments/${d.post_id}`,"$2Nn8Cs0MvJ")),n=await n,l(),n),a=O(),p=async()=>{var s,i;if(!((s=a.user)!=null&&s.id))return alert("Reg or log IN");e.value=e.value.replaceAll("<","&lt;").replaceAll(">","&gt;"),e.value&&(await fetch(`/api/comments/${d.post_id}`,{method:"POST",body:JSON.stringify({text:e.value,post_id:d.post_id,author_id:(i=a.user)==null?void 0:i.id})}),e.value="",r())},m=s=>{(s.keyCode==10||s.keyCode==13)&&(s.ctrlKey||s.metaKey)&&p()};return(s,i)=>{var _;const M=T;return u(),f(C,null,[o("form",{onSubmit:B(p,["prevent"])},[N(o("textarea",{class:"enterComment",placeholder:"Введите комментарий","onUpdate:modelValue":i[0]||(i[0]=h=>b(e)?e.value=h:null),onKeydown:m},null,544),[[$,c(e)]])],32),i[1]||(i[1]=o("br",null,null,-1)),o("div",R,[(u(!0),f(C,null,A((_=c(y))==null?void 0:_.comments,h=>{var g;return u(),K(M,{key:h.id,comment:h,margin:0,author_id:(g=c(a).user)==null?void 0:g.id,refresh:c(r)},null,8,["comment","author_id","refresh"])}),128))])],64)}}});export{D as _};
